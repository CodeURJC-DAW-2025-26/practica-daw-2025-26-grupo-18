{{>header}}

<main class="main">

	<!-- Page Title -->
	<div class="page-title light-background">
		<div class="container">
			<nav class="breadcrumbs">
				<ol>
					<li><a href="/">Inicio</a></li>
					<li class="current">Perfil</li>
				</ol>
			</nav>
			<h1>Perfil de estudiante</h1>
		</div>
	</div><!-- End Page Title -->

	<!-- Profile Overview -->
	<section class="section">
		<div class="container" data-aos="fade-up">
			<div class="row g-4">
				<div class="col-lg-4">
					<div class="card border-0 shadow-sm bg-light h-100">
						<div class="card-body p-4 text-center">
							<!-- Vista normal -->
							<div id="profile-view">
								<img src="/images/users/{{user.id}}/profile" alt="Foto de perfil" class="rounded-circle mb-3"
									width="120" height="120">
								<h3 class="h5 fw-bold mb-1">{{user.username}}</h3>
								<p class="text-muted mb-1">@{{user.username}}</p>
								<p class="text-muted mb-3">{{userType}}</p>
								<div class="course-tags justify-content-center">
									{{#userTags}}
									<span class="course-tag">{{.}}</span>
									{{/userTags}}
									{{^userTags}}
									<span class="text-muted small">Sin cursos suscritos</span>
									{{/userTags}}
								</div>
								<hr class="my-4">
								<div class="text-start">
									<p class="mb-2"><i class="bi bi-envelope me-2"></i> {{user.email}}</p>
									<p class="mb-2"><i class="bi bi-geo-alt me-2"></i> {{user.country}}</p>
									<p class="mb-0"><i class="bi bi-calendar-event me-2"></i> Miembro desde 2024</p>
								</div>
							</div>

							<!-- Vista edición -->
							<div id="profile-edit" style="display: none;">
								<form action="/profile/{{user.id}}/edit" method="post" enctype="multipart/form-data">
									<input type="hidden" name="_csrf" value="{{_csrf.token}}" />

									<!-- Imagen de perfil -->
									<div class="mb-3">
										<img id="preview-img" src="/images/users/{{user.id}}/profile" alt="Foto de perfil" class="rounded-circle mb-2"
											width="120" height="120">
										<div>
											<label for="imageFile" class="form-label small text-muted">Cambiar imagen</label>
											<input type="file" class="form-control form-control-sm" id="imageFile" name="imageFile" accept="image/*"
												onchange="previewImage(event)">
										</div>
									</div>

									<!-- Username -->
									<div class="mb-3 text-start">
										<label for="username" class="form-label fw-semibold"><i class="bi bi-person me-2"></i>Nombre de usuario</label>
										<input type="text" class="form-control" id="username" name="username" value="{{user.username}}" required>
									</div>

									<!-- Email -->
									<div class="mb-3 text-start">
										<label for="email" class="form-label fw-semibold"><i class="bi bi-envelope me-2"></i>Email</label>
										<input type="email" class="form-control" id="email" name="email" value="{{user.email}}" required>
									</div>

									<!-- País -->
									<div class="mb-3 text-start">
										<label for="country" class="form-label fw-semibold"><i class="bi bi-geo-alt me-2"></i>País</label>
										<input type="text" class="form-control" id="country" name="country" value="{{user.country}}">
									</div>

									<!-- Descripción -->
									<div class="mb-3 text-start">
										<label for="shortDescription" class="form-label fw-semibold"><i class="bi bi-card-text me-2"></i>Sobre mí</label>
										<textarea class="form-control" id="shortDescription" name="shortDescription" rows="3" placeholder="Cuéntanos algo sobre ti...">{{#user}}{{shortDescription}}{{/user}}</textarea>
									</div>

									<!-- Objetivo actual -->
									<div class="mb-3 text-start">
										<label for="currentGoal" class="form-label fw-semibold"><i class="bi bi-briefcase me-2"></i>Objetivo actual</label>
										<input type="text" class="form-control" id="currentGoal" name="currentGoal" value="{{#user}}{{currentGoal}}{{/user}}" placeholder="Ej: Lanzar mi startup en 2026">
									</div>

									<!-- Rutina semanal -->
									<div class="mb-3 text-start">
										<label for="weeklyRoutine" class="form-label fw-semibold"><i class="bi bi-lightning me-2"></i>Rutina semanal</label>
										<input type="text" class="form-control" id="weeklyRoutine" name="weeklyRoutine" value="{{#user}}{{weeklyRoutine}}{{/user}}" placeholder="Ej: 6h de formación y 2h networking">
									</div>

									<!-- Comunidad -->
									<div class="mb-3 text-start">
										<label for="comunity" class="form-label fw-semibold"><i class="bi bi-people me-2"></i>Comunidad</label>
										<input type="text" class="form-control" id="comunity" name="comunity" value="{{#user}}{{comunity}}{{/user}}" placeholder="Ej: SCAM Builders · Madrid">
									</div>

									<div class="d-flex gap-2 justify-content-center mt-3">
										<button type="submit" class="btn btn-accent">Guardar cambios</button>
										<button type="button" class="btn btn-accent-outline" onclick="toggleEdit()">Cancelar</button>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>

				<div class="col-lg-8">
					<div class="card border-0 shadow-sm bg-light h-100">
						<div class="card-body p-4">
							<h3 class="h5 fw-bold mb-3">Sobre mi</h3>
							<p class="text-muted">{{#user.shortDescription}}{{user.shortDescription}}{{/user.shortDescription}}{{^user.shortDescription}}Todavía no se ha añadido ninguna información.{{/user.shortDescription}}</p>
							<div class="row g-3">
								<div class="col-md-6">
									<div class="d-flex align-items-center gap-3">
										<i class="bi bi-briefcase fs-4 text-accent"></i>
										<div>
											<p class="mb-1 fw-semibold">Objetivo actual</p>
											<p class="mb-0 text-muted">{{#user.currentGoal}}{{user.currentGoal}}{{/user.currentGoal}}{{^user.currentGoal}}Todavía no se ha añadido ninguna información.{{/user.currentGoal}}</p>
										</div>
									</div>
								</div>
								<div class="col-md-6">
									<div class="d-flex align-items-center gap-3">
										<i class="bi bi-lightning fs-4 text-accent"></i>
										<div>
											<p class="mb-1 fw-semibold">Rutina semanal</p>
											<p class="mb-0 text-muted">{{#user.weeklyRoutine}}{{user.weeklyRoutine}}{{/user.weeklyRoutine}}{{^user.weeklyRoutine}}Todavía no se ha añadido ninguna información.{{/user.weeklyRoutine}}</p>
										</div>
									</div>
								</div>
								<div class="col-md-6">
									<div class="d-flex align-items-center gap-3">
										<i class="bi bi-people fs-4 text-accent"></i>
										<div>
											<p class="mb-1 fw-semibold">Comunidad</p>
											<p class="mb-0 text-muted">{{#user.comunity}}{{user.comunity}}{{/user.comunity}}{{^user.comunity}}Todavía no se ha añadido ninguna información.{{/user.comunity}}</p>
										</div>
									</div>
								</div>
								<div class="col-md-6">
									<div class="d-flex align-items-center gap-3">
										<i class="bi bi-award fs-4 text-accent"></i>
										<div>
											<p class="mb-1 fw-semibold">Certificaciones</p>
											<p class="mb-0 text-muted">{{completedCourses}} completadas</p>
										</div>
									</div>
								</div>
							</div>
							<div class="d-flex flex-wrap gap-2 mt-4">
								<a href="#" class="btn btn-accent" onclick="toggleEdit(); return false;">Editar perfil</a>
								<a href="#" class="btn btn-accent-outline">Gestionar suscripcion</a>
							</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- Progress Cards -->
	<section id="features-cards" class="features-cards section">
		<div class="container" data-aos="fade-up" data-aos-delay="100">
			<div class="row g-4">
				<div class="col-lg-4" data-aos="flip-left" data-aos-delay="100">
					<div class="feature-card">
						<div class="icon-badge">
							<div class="icon-box icon-box-compact">
								<i class="bi bi-journal-text"></i>
							</div>
							<span class="badge status-badge">ACTIVO</span>
						</div>
						<h3>Cursos en progreso</h3>
						<p>Actualmente estas avanzando en {{inProgressCount}} cursos.</p>
						<div class="course-progress">
							<small class="course-progress-label">Progreso global: {{overallProgress}}%</small>
							<div class="course-progress-bar">
								<div class="course-progress-fill" data-progress="{{overallProgress}}"></div>
							</div>
						</div>
						<ul class="feature-list">
							<li><i class="bi bi-check-circle"></i> {{completedLessons}} clases completadas</li>
							<li><i class="bi bi-check-circle"></i> 6 practicas entregadas</li>
						</ul>
						<div class="text-center mt-3">
							<img src="../img/chart_student_status_pie.png" alt="Estado de cursos"
								class="img-fluid rounded shadow-sm" style="max-height: 200px;">
						</div>
						<a href="#" class="read-more">Ver mis cursos <i class="bi bi-arrow-right"></i></a>
					</div>
				</div>

				<div class="col-lg-4" data-aos="flip-left" data-aos-delay="200">
					<div class="feature-card">
						<div class="icon-badge">
							<div class="icon-box icon-box-compact">
								<i class="bi bi-clock-history"></i>
							</div>
							<span class="badge status-badge">CONSTANCIA</span>
						</div>
						<h3>Horas de estudio</h3>
						<p>Has acumulado 42 horas de formacion en los ultimos 30 dias.</p>
						<!-- Weekly Activity Chart -->
						<div class="text-center mt-3 mb-3">
							<img src="../img/chart_student_weekly_bar.png" alt="Actividad semanal"
								class="img-fluid rounded shadow-sm" style="max-height: 180px;">
						</div>
						<div class="course-progress">
							<small class="course-progress-label">Meta mensual: 50h</small>
							<div class="course-progress-bar">
								<div class="course-progress-fill course-progress-fill--40"></div>
							</div>
						</div>
						<ul class="feature-list">
							<li><i class="bi bi-check-circle"></i> 4 semanas consecutivas</li>
							<li><i class="bi bi-check-circle"></i> 3 sesiones en vivo</li>
						</ul>
						<a href="#" class="read-more">Ver estadisticas <i class="bi bi-arrow-right"></i></a>
					</div>
				</div>

				<div class="col-lg-4" data-aos="flip-left" data-aos-delay="300">
					<div class="feature-card">
						<div class="icon-badge">
							<div class="icon-box icon-box-compact">
								<i class="bi bi-award"></i>
							</div>
							<span class="badge status-badge">LOGROS</span>
						</div>
						<h3>Certificados</h3>
						<p>{{completedCourses}} certificados completados y {{inProgressCount}} cursos en progreso.</p>
						<ul class="feature-list">
							{{#completedCourseNames}}
							<li><i class="bi bi-check-circle"></i> {{.}}</li>
							{{/completedCourseNames}}
							{{^completedCourseNames}}
							<li class="text-muted"><i class="bi bi-info-circle"></i> Aun no has completado ningun curso</li>
							{{/completedCourseNames}}
						</ul>
					</div>
				</div>
			</div>
		</div>
	</section>

	{{#isPublisher}}
	<!-- Instructor Panel (Role >= 2) -->
	<section class="section bg-light">
		<div class="container" data-aos="fade-up">
			<div class="section-title section-title-compact">
				<h2>Panel de Instructor</h2>
				<p>Gestiona tus cursos creados y visualiza el progreso de tus estudiantes.</p>
			</div>

			<div class="row g-4">
				<!-- Created Course 1 -->
				<div class="col-lg-6">
					<div class="card border-0 shadow-sm h-100">
						<div class="card-body p-4">
							<div class="d-flex justify-content-between align-items-center mb-3">
								<h4 class="h5 fw-bold mb-0">Curso de Diseño Web Avanzado</h4>
								<span class="badge bg-success">Publicado</span>
							</div>
							<div class="row align-items-center">
								<div class="col-md-5">
									<p class="text-muted small mb-2">Estado de estudiantes:</p>
									<ul class="list-unstyled small text-secondary">
										<li class="mb-1"><i class="bi bi-circle-fill text-secondary me-2"
												style="font-size: 8px;"></i>Visitado: 50%</li>
										<li class="mb-1"><i class="bi bi-circle-fill text-primary me-2"
												style="font-size: 8px;"></i>En curso: 30%</li>
										<li class="mb-1"><i class="bi bi-circle-fill text-success me-2"
												style="font-size: 8px;"></i>Completado: 20%</li>
									</ul>
									<a href="#" class="btn btn-sm btn-outline-primary mt-2">Gestionar curso</a>
								</div>
								<div class="col-md-7 text-center">
									<img src="../img/chart_created_course_status_pie.png" alt="Estado de estudiantes"
										class="img-fluid" style="max-height: 180px;">
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Created Course 2 -->
				<div class="col-lg-6">
					<div class="card border-0 shadow-sm h-100">
						<div class="card-body p-4 d-flex align-items-center justify-content-center border-dashed">
							<div class="text-center py-4">
								<div class="icon-box mb-3 mx-auto text-muted">
									<i class="bi bi-plus-lg fs-3"></i>
								</div>
								<h5 class="fw-bold text-muted">Crear nuevo curso</h5>
								<a href="createCourse.html" class="stretched-link"></a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	{{/isPublisher}}

	<!-- Courses List -->
	<section class="courses-catalog section">
		<div class="container" data-aos="fade-up">
			<div class="section-title section-title-compact">
				<h2>Mis cursos suscritos</h2>
				<p>Continua donde lo dejaste y completa tus rutas activas.</p>
			</div>

			<div class="course-list">
				{{#subscribedCourses}}
				<article class="course-card-full" data-aos="fade-up">
					<div class="course-card-header">
						<div>
							<h3 class="course-card-title">{{title}}</h3>
							<div class="course-tags">
								{{#tags}}
								<span class="course-tag">{{.}}</span>
								{{/tags}}
							</div>
						</div>
						<div class="course-card-price">
							{{#isCompleted}}
							<span class="badge bg-success">Completado · 100%</span>
							{{/isCompleted}}
							{{^isCompleted}}
							<span class="badge" style="background-color: var(--accent-color); color: #fff;">En curso · {{progress}}%</span>
							{{/isCompleted}}
						</div>
					</div>
					<p class="course-card-desc">{{description}}</p>
					<div class="course-card-meta">
						<div><i class="bi bi-person"></i> {{creatorName}}</div>
					</div>
					<div class="course-progress mt-3">
						<small class="course-progress-label">Avance actual</small>
						<div class="course-progress-bar" style="height: 10px;">
							<div class="course-progress-fill" data-progress="{{progress}}"></div>
						</div>
					</div>
					<div class="course-card-actions">
						<a href="/course/{{courseId}}" class="btn btn-sm btn-accent-outline course-card-btn">Ver detalles</a>
					</div>
				</article>
				{{/subscribedCourses}}
				{{^subscribedCourses}}
				<p class="text-muted text-center">No estas suscrito a ningun curso todavia.</p>
				{{/subscribedCourses}}
			</div>
		</div>
	</section>

	<!-- Upcoming Events -->
	<section class="section">
		<div class="container" data-aos="fade-up">
			<div class="section-title section-title-compact">
				<h2>Eventos guardados</h2>
				<p>Actividades que has marcado para ampliar tu red profesional.</p>
			</div>
			<div class="list-group">
				{{#userEvents}}
				<a href="/event/{{eventId}}"
					class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
					<div>
						<h6 class="mb-1">{{title}}</h6>
						<small class="text-muted"><i class="bi bi-geo-alt me-1"></i> {{locationLabel}}</small>
					</div>
					<span class="badge bg-light text-dark border">{{startDate}}</span>
				</a>
				{{/userEvents}}
				{{^userEvents}}
				<p class="text-muted text-center">No tienes eventos guardados.</p>
				{{/userEvents}}
			</div>
		</div>
	</section>

</main>

{{>footer}}

<script>
function toggleEdit() {
	var view = document.getElementById('profile-view');
	var edit = document.getElementById('profile-edit');
	if (view.style.display === 'none') {
		view.style.display = 'block';
		edit.style.display = 'none';
	} else {
		view.style.display = 'none';
		edit.style.display = 'block';
	}
}

function previewImage(event) {
	var reader = new FileReader();
	reader.onload = function() {
		document.getElementById('preview-img').src = reader.result;
	};
	reader.readAsDataURL(event.target.files[0]);
}

document.querySelectorAll('.course-progress-fill[data-progress]').forEach(function (bar) {
	var value = parseInt(bar.getAttribute('data-progress'), 10);
	if (isNaN(value)) value = 0;
	value = Math.max(0, Math.min(100, value));
	bar.style.width = value + '%';
});
</script>

</body>

</html>